# ICC Brightness

*Control OLED display brightness by applying ICC color profiles.*

## Introduction

This tool is a work-around for displays whose brightness contol is not
supported by the linux kernel. It preforms well on OLED displays,
since these have very dark black point and their power consumption is
relative to the brightness of the viewed content.

This tool can be used on an LCD display, but in that case you really want
to control the brightness directly using the display backlight.

Specifically icc-brightness was developed for the
Lenovo ThinkPad X1 Yoga OLED display.

## Build and install

The build requires the liblcms2 development package:

```console
$ sudo apt install liblcms2-dev
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  liblcms2-dev
...
```

Build and run the tool to see all options:

```console
$ make
gcc -W -Wall icc-brightness-gen.c -l lcms2 -o icc-brightness-gen
$ ./icc-brightness
Control OLED display brightness by applying ICC color profiles.

icc-brightness brightness max-brightness - set brightness manually
icc-brightness apply - apply brightness from system setting
icc-brightness watch - continuously update to system setting
icc-brightness clean - remove all profiles generated by us
```

You can install to auto-start a daemon when logging-in to a Gnome session:

```console
$ sudo make install
cp icc-brightness-gen /usr/local/bin/
cp icc-brightness /usr/local/bin/
cp icc-brightness.desktop /usr/share/gnome/autostart/
```

The daemon will start on your next login.
You can change brightness using the brightness key or any other method
that controls the display "backlight".

To remove this global installation:

```console
$ sudo make uninstall
rm -f /usr/local/bin/icc-brightness-gen
rm -f /usr/local/bin/icc-brightness
rm -f /usr/share/gnome/autostart/icc-brightness.desktop
```

If you prefer to install this daemon as a local user:

```console
$ make local-install
mkdir -p ~/.local/bin/
install -m 755 icc-brightness-gen ~/.local/bin/
install -m 755 icc-brightness ~/.local/bin/
mkdir -p ~/.config/autostart/
install -m 644 icc-brightness.desktop ~/.config/autostart/
```

And you can remove this local installation with:

```console
$ make local-uninstall
rm -f ~/.local/bin/icc-brightness-gen
rm -f ~/.local/bin/icc-brightness
rm -f ~/.config/autostart/icc-brightness.desktop
```

## Multiple Displays

If you like to use an external monitor in addition to your laptop display, you
may find your brightness keys changing the brightness of your monitor instead of
your laptop.
A workaround is to explicitly set the device that you want `icc-brightness` to
target.

First get a list of device models that `icc_brightness` can see:

```console
$ ./icc-brightness list
XPS 15 7590
LG Ultra HD
```

Next modify the commands you use to specify the device model you want to operate
on:

```console
./icc-brightness --target XPS apply
```

Note, you only need to specify a unique prefix for the `--target` argument.
